<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Keep calm and write something"><meta property="og:type" content="article"><meta property="og:image" content="https://cychong47.github.io/img/home-bg-jeep.jpg"><meta property="twitter:image" content="https://cychong47.github.io/img/home-bg-jeep.jpg"><meta name=title content="ghost deployment season 4"><meta property="og:title" content="ghost deployment season 4"><meta property="twitter:title" content="ghost deployment season 4"><meta name=description content="Keep calm and write something"><meta property="og:description" content="Keep calm and write something"><meta property="twitter:description" content="Keep calm and write something"><meta property="twitter:card" content="summary"><meta name=keyword content="Blog, cychong, Kubernetes, dpdk"><link rel="shortcut icon" href=/img/favicon.ico><title>ghost deployment season 4-another blog</title><link rel=canonical href=/post/2019/ghost-deployment-season-4/><link rel=stylesheet href=/css/iDisqus.min.css><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hux-blog.min.css><link rel=stylesheet href=/css/zanshang.css><link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=/>Keep calm and write something</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>Home</a></li><li><a href=/categories/book>book</a></li><li><a href=/categories/gadget>gadget</a></li><li><a href=/categories/homelab>homelab</a></li><li><a href=/categories/hugo>hugo</a></li><li><a href=/categories/kubernetes>kubernetes</a></li><li><a href=/categories/life>life</a></li><li><a href=/categories/news>news</a></li><li><a href=/categories/note>note</a></li><li><a href=/categories/til>til</a></li><li><a href=/search>SEARCH <img src=/img/search.png height=15 style=cursor:pointer alt=Search></a></li></ul></div></div></div></nav><script>var $body=document.body;var $toggle=document.querySelector('.navbar-toggle');var $navbar=document.querySelector('#huxblog_navbar');var $collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic)
function handleMagic(e){if($navbar.className.indexOf('in')>0){$navbar.className=" ";setTimeout(function(){if($navbar.className.indexOf('in')<0){$collapse.style.height="0px"}},400)}else{$collapse.style.height="auto"
$navbar.className+=" in";}}</script><style type=text/css>header.intro-header{background-image:url(/img/home-bg-jeep.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/ghost title=ghost>ghost</a>
<a class=tag href=/tags/kubernetes title=kubernetes>kubernetes</a></div><h1>ghost deployment season 4</h1><h2 class=subheading></h2><span class=meta>Posted by
Chaeyong Chong
on
Sunday, May 19, 2019</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-11 col-lg-offset-1
col-md-10 col-md-offset-1
post-container"><header><h2>TOC</h2></header><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav><p>ghost blog를 구성해서 사용한 게 벌써 2014년 이다. 당시 0.x 버전 이었던 초반에는 얼마 못 가고 사라지지 않을까 걱정했는데 한참을 1.0버전을 발표하지 않더니 벌써 2.x 버전이다.</p><p>그동안 내가 ghost 블로그를 운용하는 방식도 몇 번의 변화를 가졌다.</p><h3 id=시즌-1---brew--tar-ball>시즌 1 - brew & tar-ball</h3><p>처음에는 매뉴얼 대로 직접 Node.js와 ghost 소스를 이용해서 직접 OS X에 설치해서 운용했다.</p><h3 id=시즌-2---docker>시즌 2 - Docker</h3><p>그러다 Node.js 버전이 꼬이는 것도 그렇고, docker를 쓰면 ghost 버전이 새로 나왔을 때 편할 듯 해서 <a href=http://sosa0sa.com:2368/move-to-docker/>docker를 쓰는 방식으로 변경했다</a>. 이 시점에 docker의 stateless 속성을 이용하고, 데이터의 백업도 고려해서 ghost content는 Dropbox에 두고, docker 실행할 때 volume으로 마운트 하는 방식을 사용했다.
그 당시 ghost보다 먼저 운용하고 있던 <a href=http://sosa0sa.com:2368/install-wordpress-with-docker/>wordpress도 함께 docker로 실행 환경을 바꿨다</a>. wordpess는 ghost와 달리 MySql을 필요로 해서 docker-compose를 이용해서 두 개의 container를 연동해서 실행했다.</p><h3 id=시즌-3---ansible로-remote-deploy>시즌 3 - Ansible로 remote deploy</h3><p>이 당시에 ghost 블로그가 실행되는 mac mini 2011이 아닌 MacBookPro 2017에서 주로 작업을 하고 있던 터라 MacBookPro에서 mac mini에 로그인해서 작업하는 것도 귀찮아 원격(?)으로 ghost 업데이트를 하기 위해 <a href=http://sosa0sa.com:2368/recreate-ghost-container/>ansible을 이용해서 ghost를 deploy</a> 할 수 있게 했다.</p><h3 id=시즌-4---deploy-with-kubernetes>시즌 4 - Deploy with kubernetes</h3><p>docker, ansible로 실행 환경을 구성해 놓은 덕에 ghost와 wordpress를 기존에 Mac OS X의 docker for Mac을 사용하던 mini2 에서 Ubuntu를 설치한 mini1으로 별 다른 문제 없이 쉽게 옮길 수 있었다.</p><p>Docker for Mac 보다 훨씬 안정적인 docker 덕에 아무런 문제 없이 쓰고 있었는데 괜히 kubernetes 환경으로 꾸며보고 싶었다. 개인 블로그라 특별한 장점이 있을까 싶긴 하지만, kubernetes 공부도 할 겸해서 바꿔보기로 했다. 눈으로만 익히고 입개발만 하기 보다는 직접 해보는 게 남는 게 많을 거라 내가 가진 환경에서 kubernetes를 운용할 수 있는 방법부터 찾아 봤다.</p><p>내 환경</p><p>집에 있는 머신 들은 다음과 같다.</p><ul><li>Mac mini1 2009 - Ubuntu 18.04 LTS. 현재 ghost, wordpress 블로그 운용 중</li><li>Mac mini2 2011 - OS X</li><li>HP mini PC - Windows 10</li><li>MacBook Pro 2017 - OS X</li></ul><p>kubernetes의 기본 환경 구성이 Master와 Node라 대개 2개의 머신을 기본으로 요구한다. 한 대의 머신으로도 kubernetes를 구성할 수 있는 <a href=https://kubernetes.io/docs/setup/minikube/>MiniKube</a>등이 있지만 VM을 기반으로 하는 거라 벌써 연식이 10년이 넘은 mini1에서 돌리기에는 부담이 되보였다.
그래서 Docker for Mac이 설치되어 있는 mini2를 master로 하고, mini1을 node로 사용하는 방법을 생각하고 시도해봤다. 하지만 아직 Docker for Mac은 node를 추가하는 건 지원하지 않는다고.
그럼 worker node를 mini2에서 돌려야 한다는 건데 굳이 다시 mini2으로 container 실행 환경을 돌리고 싶지는 않았다.</p><p>그래서 mini2만으로 kubernetes를 구성할 수 있는 방법을 찾아 보다 <a href=https://microk8s.io/>microk8s</a>를 적용해 보기로 했다. Canonical에서 공개한 kubernetes 실행 환경인데 local machine에서 실행할 수 있도록 경량화 한 것이 특정이라고 한다.</p><blockquote><p>It’s not elastic, but it is on rails. Use it for offline development, prototyping, testing, or use it on a VM as a small, cheap, reliable k8s for CI/CD. Makes a great k8s for appliances - develop your IoT apps for k8s and deploy them to MicroK8s on your boxes.</p></blockquote><p>기본적인 설치는 <code>snap</code> 을 이용하는데 <a href=https://microk8s.io/>https://microk8s.io/</a> 페이지에 있는 명령을 이용하면 간단하게 kubernetes 환경 구성이 가능하다.</p><p>Ghost를 kubernetes에 설치하는 것이 내가 처음은 아닐 듯 해서 검색해 보니 <a href=https://mendoza.io/how-to-run-ghost-in-kubernetes/amp/>How to run Ghost in Kubernetes</a> 이런 글이 나왔다. 2018년 12월 글이라 크게 달라진 점은 없을 듯 해서 kubernetes.io의 글과 이 글을 이용해서 하나 하나 따라갔다. 결론적으로 내가 구성한 환경 역시 이 분이 작성하신 것과 큰 차이가 없지만 한가지 차이점 때문에 몇 시간을 헤매야 했다. 이글은 Digital Ocean 환경에서 제공하는 kubernetes를 이용하여 ghost를 구성했는데 내가 구성한 환경은 microk8s였다. 가장 큰 차이점 중 하나가 microk8s는 외부에 서비스를 expose할 때 사용할 수 있는 방식 중 LoadBalancer를 원하지 않는다는 점이다.</p><p>자세한 설치기는 to be continued&mldr;</p><hr><ul class=pager><li class=previous><a href=/post/2019/kubernetes-networks/ data-toggle=tooltip data-placement=top title="Kubernetes Networks">&larr;
Previous Post</a></li><li class=next><a href=/post/2019/setup-ghost-in-microk8s-2/ data-toggle=tooltip data-placement=top title="Setup Ghost in microk8s">Next
Post &rarr;</a></li></ul><div id=disqus-comment></div></div><div class="col-lg-11 col-lg-offset-1
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/agile title=agile>agile</a>
<a href=/tags/amazon title=amazon>amazon</a>
<a href=/tags/amdocs title=amdocs>amdocs</a>
<a href=/tags/ansible title=ansible>ansible</a>
<a href=/tags/ansible-playbook title=ansible-playbook>ansible-playbook</a>
<a href=/tags/anti-work-pattern title=anti-work-pattern>anti-work-pattern</a>
<a href=/tags/apple title=apple>apple</a>
<a href=/tags/automation title=automation>automation</a>
<a href=/tags/backup title=backup>backup</a>
<a href=/tags/book title=book>book</a>
<a href=/tags/brew title=brew>brew</a>
<a href=/tags/calico title=calico>calico</a>
<a href=/tags/cisco title=cisco>cisco</a>
<a href=/tags/cni title=cni>cni</a>
<a href=/tags/coding-style title=coding-style>coding-style</a>
<a href=/tags/container title=container>container</a>
<a href=/tags/cron title=cron>cron</a>
<a href=/tags/cronjob title=cronjob>cronjob</a>
<a href=/tags/cuda title=cuda>cuda</a>
<a href=/tags/culture title=culture>culture</a>
<a href=/tags/dev-culture title=dev-culture>dev-culture</a>
<a href=/tags/docker title=docker>docker</a>
<a href=/tags/docker-compose title=docker-compose>docker-compose</a>
<a href=/tags/dpdk title=dpdk>dpdk</a>
<a href=/tags/elk title=elk>elk</a>
<a href=/tags/english title=english>english</a>
<a href=/tags/getting-started title=getting-started>getting-started</a>
<a href=/tags/ghost title=ghost>ghost</a>
<a href=/tags/git title=git>git</a>
<a href=/tags/github title=github>github</a>
<a href=/tags/golang title=golang>golang</a>
<a href=/tags/google title=google>google</a>
<a href=/tags/gpu title=gpu>gpu</a>
<a href=/tags/grafana title=grafana>grafana</a>
<a href=/tags/helm title=helm>helm</a>
<a href=/tags/homebrew title=homebrew>homebrew</a>
<a href=/tags/http title=http>http</a>
<a href=/tags/hugo title=hugo>hugo</a>
<a href=/tags/influxdb title=influxdb>influxdb</a>
<a href=/tags/intel title=intel>intel</a>
<a href=/tags/ipad title=ipad>ipad</a>
<a href=/tags/iphone title=iphone>iphone</a>
<a href=/tags/ipsec title=ipsec>ipsec</a>
<a href=/tags/json title=json>json</a>
<a href=/tags/kubernetes title=kubernetes>kubernetes</a>
<a href=/tags/life title=life>life</a>
<a href=/tags/lifehack title=lifehack>lifehack</a>
<a href=/tags/mac-mini-2009 title=mac-mini-2009>mac-mini-2009</a>
<a href=/tags/manager title=manager>manager</a>
<a href=/tags/monitoring title=monitoring>monitoring</a>
<a href=/tags/mysql title=mysql>mysql</a>
<a href=/tags/nfv title=nfv>nfv</a>
<a href=/tags/nginx title=nginx>nginx</a>
<a href=/tags/note title=note>note</a>
<a href=/tags/odp title=odp>odp</a>
<a href=/tags/onap title=onap>onap</a>
<a href=/tags/onp title=onp>onp</a>
<a href=/tags/openstack title=openstack>openstack</a>
<a href=/tags/opnfv title=opnfv>opnfv</a>
<a href=/tags/osx title=osx>osx</a>
<a href=/tags/ovdk title=ovdk>ovdk</a>
<a href=/tags/ovs title=ovs>ovs</a>
<a href=/tags/photo title=photo>photo</a>
<a href=/tags/podcast title=podcast>podcast</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/protocol-buffer title=protocol-buffer>protocol-buffer</a>
<a href=/tags/python title=python>python</a>
<a href=/tags/scapy title=scapy>scapy</a>
<a href=/tags/sdn title=sdn>sdn</a>
<a href=/tags/slack title=slack>slack</a>
<a href=/tags/sw-%EA%B0%9C%EB%B0%9C-%EB%AC%B8%ED%99%94 title=sw-개발-문화>sw-개발-문화</a>
<a href=/tags/team title=team>team</a>
<a href=/tags/telemetry title=telemetry>telemetry</a>
<a href=/tags/til title=til>til</a>
<a href=/tags/troubleshooting title=troubleshooting>troubleshooting</a>
<a href=/tags/ubuntu title=ubuntu>ubuntu</a>
<a href=/tags/vagrant title=vagrant>vagrant</a>
<a href=/tags/virtualization title=virtualization>virtualization</a>
<a href=/tags/vmware title=vmware>vmware</a>
<a href=/tags/vnf title=vnf>vnf</a>
<a href=/tags/vran title=vran>vran</a>
<a href=/tags/wordpress title=wordpress>wordpress</a>
<a href=/tags/%EA%B3%B5%EB%B6%80 title=공부>공부</a>
<a href=/tags/%EA%B4%80%EB%A6%AC%EB%8A%A5%EB%A0%A5 title=관리능력>관리능력</a>
<a href=/tags/%EA%B8%B0%EB%A1%9D title=기록>기록</a>
<a href=/tags/%EB%A6%AC%EB%8D%94 title=리더>리더</a>
<a href=/tags/%EB%AC%B8%ED%99%94 title=문화>문화</a>
<a href=/tags/%EC%83%9D%EC%82%B0%EC%84%B1 title=생산성>생산성</a>
<a href=/tags/%EC%9E%A1%EC%83%9D%EA%B0%81 title=잡생각>잡생각</a>
<a href=/tags/%EC%A1%B0%EC%A7%81%EA%B4%80%EB%A6%AC title=조직관리>조직관리</a>
<a href=/tags/%ED%9A%8C%EC%9D%98 title=회의>회의</a></div></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href rel=alternate type=application/rss+xml title="Keep calm and write something"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li><a href=mailto:youremail@gmail.com><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/your%20wechat%20qr%20code%20image><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-wechat fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/yourgithub><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/yourlinkedinid><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/yourstackoverflowid><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Keep calm and write something 2020<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function async(u,c){var d=document,t='script',o=d.createElement(t),s=d.getElementsByTagName(t)[0];o.src=u;if(c){o.addEventListener('load',function(e){c(null,e);},false);}
s.parentNode.insertBefore(o,s);}</script><script>if($('#tag_cloud').length!==0){async("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:'#bbbbee',end:'#0085a1'},};$('#tag_cloud a').tagcloud();})}</script><script>async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js",function(){var $nav=document.querySelector("nav");if($nav)FastClick.attach($nav);})</script></body></html>